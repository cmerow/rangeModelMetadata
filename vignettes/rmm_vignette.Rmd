---
title: "An overview of making rangeModelMetadata objects"
author: "Cory Merow, Brian Maitner, Hannah Owens"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    fig_caption: yes
    toc: true
    toc_depth: 3
vignette: >
  %\VignetteIndexEntry{An overview of making rangeModelMetadata objects}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rangeModelMetadata)
```

##What is an rmm (rangeModelMetadata) object?

A simple `rmm` object is a list object that is structured to contain metadata pertaining to species range models.
```{r}
rmm1=rmmTemplate(useCase=c('obligate')) #  Make an empty rmm object containing only the obligate set of fields.
str(rmm1)
```

A more complex `rmm` object with all predefined fields.
```{r}
rmm2=rmmTemplate(useCase=NULL)
str(rmm2)
```

##Populating an rmm object

`rmm` objects can be populated manually by entering data direcetly into the fields, or through the use of several helper functions.  Although the `rmm` object template already contain a number of fields that depend on the specified `useCase`, users can also add new fields as needed.  We are able to provide suggestions of both common fields to add and common values for many fields.

Not sure what to enter in different fields? We can suggest options.

```{r}
rmmSuggest('dataPrep',fullFieldDepth=FALSE)
rmmSuggest('dataPrep',fullFieldDepth=TRUE) # for all fields below the specified one
rmmSuggest('dataPrep$errors$duplicateRemoval')
rmmSuggest('dataPrep$errors$duplicateRemoval$rule')
```

Another more complex example:

```{r}
rmmSuggest('model')
rmmSuggest('model$maxent$')
rmmSuggest('$model$maxent$featureSet')
```


To make it easier to fill some `rmm` fields, we provide autofill functions that extract relevant information from common R objects used in the 

```{r}
rmm=rmmTemplate(useCase=NULL)
rmm=rmmAutofillPackageCitation(rmm,c('raster','sp'))
# rmmAutoFillData(rmm,species=)
raster.files=list.files(system.file("extdata/Env_Demo",package='rangeModelMetadata'),full.names = TRUE)
env=raster::stack(raster.files)
rmm=rmmAutofillEnvironment(rmm,env,transfer=0) # for fitting environment
rmm=rmmAutofillEnvironment(rmm,env,transfer=1) # for transfer environment 1 (assuming different than for fitting)
rmm=rmmAutofillEnvironment(rmm,env,transfer=2) # for transfer environment 2 (assuming different than for fitting)
# rmmAutoFillMaxent(rmm,species=)
# rmmAutoFillPrediction(rmm,species=,layer=1)
rmmPrintFull(rmm) #print just the non-NULL fields
```

To see what fields you might've missed...
```{r}
# rmmFindEmpties(rmm)
# rmmCleanEmpties(rmm)
```

##Checking an rmm object

To check the field names in your object, use the function `rmmNameCheck`

```{r}

rmm<-rmmTemplate() # Make an empty template
rmm$dataPrep$biological$taxonomicHarmonization$taxonomy_source<-"The Plant List" # # Add a new, non-standard field
# temporary dev error
rmm=rmmCheckName(rmm) # Checking the names should identify the new, non-standard field we've added ("taxonomy_source")

```

To check the field values in your rmm object, use the function `rmmValueCheck`
```{r}
rmm<-rmmTemplate() #First, we create an empty rmm template
rmm$data$environment$variableNames<- c("bio1", "bio 2", "bio3", "cromulent") #We add 3 of the bioclim layers, including a spelling error (an extra space) in bio2, and a word that is clearly not a climate layer, 'cromulent'.
# TO FIX after chaging the usecase isssue
#rmmCheckValue(rmm = rmm) #Now, when we check the values, we see that bio1 and bio2 are reported as exact matches, while 'bio 2' is flagged as a partial match with a suggested value of 'bio2', and 'cromulent' is flagged as not matched at all.

#If we'd like to return a dataframe containing this information in a perhaps more useful format:
# TO FIX after chaging the usecase isssue
#rmmCheckValue_output<-rmmCheckValue(rmm = rmm,returnData = TRUE)
```

  <!-- names<-rmmCheckName(rmm,returnData = T) -->

  <!-- values<-rmmCheckValue(rmm = rmm,returnData = T) -->

  <!-- missing_names<-rmmCheckMissingNames(rmm,useCase = useCase) -->

  <!-- empty_values<-rmmCheckEmpty(rmm = rmm,useCase = useCase) -->


These 'check' functions work by comparing the values or names within an rmm object to those in a data dictionary.  These functions are designed to check for non-standard values and names, and DO NOT necessarily identify correct vs. incorrect values/names.  Non-standard values may be perfectly valid, or they may be erroneous, and the user will have to make this distinction.


##Outputing an rmm object

To make `rmm` objects portable to other interfaces, they are readily written to csv format.
```{r,eval=F}
outFile='~/Desktop/demo_rmmToCSV.csv'
rmmObj=rmmTemplate()
rmmToCSV(rmmObj,filename=outFile)
system(paste0('open ', outFile, ' -a "Microsoft Excel"'))
```


## Miscellaneous

It can be helpful to simply view the data dictionary:

```{r}
dd=rmmDataDictionary()
str(dd)
# rmmDataDictionary(excel=TRUE) # try this if you have excel
```

